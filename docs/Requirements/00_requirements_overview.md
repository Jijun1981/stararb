# 期货配对交易系统需求总览 V2.1

## 项目概述
基于协整理论的金属期货配对交易量化研究平台，采用模块化架构设计，支持多种对冲算法和完整的回测分析。

## 系统架构
```
┌─────────────────┐
│  数据管理模块    │ ← AkShare API
└────────┬────────┘
         ↓
┌─────────────────┐
│ 协整配对模块     │ (包含β估计)
└────────┬────────┘
         ↓
┌─────────────────┐
│ 信号生成模块     │
└────────┬────────┘
         ↓
┌─────────────────┐
│ 回测框架模块     │ → 报告输出
└─────────────────┘
```

## 模块清单

### 1. 数据管理模块
- **职责**: 数据获取、存储、更新、预处理
- **关键功能**: 
  - AkShare接口封装
  - Parquet格式存储
  - 增量更新机制
  - 对数价格转换
- **文档**: [01_data_management.md](01_data_management.md)

### 2. 协整配对模块
- **职责**: 协整检验、配对筛选、方向判定、β参数估计
- **关键功能**:
  - Engle-Granger检验
  - 多时间窗口分析(1-5年)
  - 波动率方向判定
  - β系数和半衰期计算
  - 批量配对筛选
- **文档**: [02_cointegration_pairing.md](02_cointegration_pairing.md)

### 3. 信号生成模块
- **职责**: 基于协整参数的交易信号生成
- **关键功能**:
  - Kalman滤波动态更新
  - 创新z和滚动z信号生成
  - 整数手数配平算法
- **文档**: [03_signal_generation.md](03_signal_generation.md)

### 4. 回测框架模块
- **职责**: 交易执行、风险管理、绩效分析
- **关键功能**:
  - 真实期货交易模拟
  - 12%保证金管理
  - 10%止损控制
  - 绩效指标计算
- **文档**: [04_backtest_framework.md](04_backtest_framework.md)

## 核心参数配置

### 数据参数
- **品种列表**: AG0, AU0, AL0, CU0, HC0, I0, NI0, PB0, RB0, SF0, SM0, SN0, SS0, ZN0 (14个)
- **数据范围**: 2020-01-01 至今
- **数据频率**: 日线数据

### 协整参数
- **检验方法**: Engle-Granger两步法
- **主筛选条件**: 5年p<0.05 且 1年p<0.05
- **方向判定**: 基于最近1年波动率

### 信号参数
- **开仓阈值**: |Z| > 2.0
- **平仓阈值**: |Z| < 0.5
- **滚动窗口**: 60个交易日
- **最大持仓**: 30天

### 回测参数
- **初始资金**: 500万
- **保证金率**: 12%
- **交易费率**: 万分之2（双边）
- **滑点**: 3个tick
- **止损线**: 保证金的10%

## 技术栈

### 编程语言
- Python 3.10+

### 核心依赖
```python
# 数据处理
pandas >= 1.5.0
numpy >= 1.23.0
pyarrow >= 10.0.0

# 数据获取
akshare >= 1.10.0

# 统计分析
statsmodels >= 0.13.0
scipy >= 1.9.0
scikit-learn >= 1.1.0

# 可视化
matplotlib >= 3.6.0
plotly >= 5.11.0

# 工具
pyyaml >= 6.0
pytest >= 7.2.0
```

## 性能要求

| 模块 | 操作 | 目标性能 |
|-----|------|---------|
| 数据管理 | 5年14品种数据加载 | < 5秒 |
| 协整配对 | 91个配对检验 | < 30秒 |
| 信号生成 | 70配对信号生成 | < 10秒 |
| 回测框架 | 2年完整回测 | < 60秒 |
| 内存占用 | 峰值内存 | < 4GB |

## 质量要求

### 代码质量
- 单元测试覆盖率 > 80%
- 代码规范: PEP 8
- 文档规范: Google Style
- 类型注解: 100%覆盖

### 数据质量
- 缺失值处理: 前向填充
- 异常值检测: 5倍标准差
- 数据验证: 每次更新后验证

### 算法准确性
- PnL计算: 精确到分
- β估计: 6位小数精度
- p值计算: 6位小数精度

## 交付物

### 源代码
- 4个核心模块Python包
- 配置文件(YAML格式)
- 单元测试代码

### 文档
- 需求文档(本文档体系)
- API文档(自动生成)
- 用户手册
- 部署指南

### 数据
- 历史数据文件(Parquet)
- 协整配对列表(CSV)
- 回测结果(CSV/Excel)

### 可视化
- 累计PnL曲线
- 配对收益分析
- 风险指标仪表板

## 项目里程碑

| 阶段 | 内容 | 预计时间 |
|-----|------|---------|
| Phase 1 | 数据管理模块开发 | 1周 |
| Phase 2 | 协整配对模块开发 | 1.5周 |
| Phase 3 | 信号生成模块开发 | 1周 |
| Phase 4 | 回测框架模块开发 | 2周 |
| Phase 5 | 集成测试与优化 | 1周 |
| Phase 6 | 文档完善与交付 | 3天 |

## 风险与缓解

| 风险 | 影响 | 缓解措施 |
|-----|------|---------|
| AkShare API变更 | 数据获取失败 | 版本锁定+备用数据源 |
| 数值计算不稳定 | 结果错误 | 异常处理+数值检查 |
| 性能不达标 | 用户体验差 | 并行计算+缓存优化 |
| 内存溢出 | 程序崩溃 | 分批处理+内存监控 |

## 版本历史

| 版本 | 日期 | 变更内容 |
|-----|------|---------|
| V2.1 | 2025-08-21 | 删除Beta估计模块，简化为4模块架构 |
| V2.0 | 2024-08-19 | 5模块架构重构 |
| V1.0 | 2024-08-01 | 初始6模块版本 |

## 联系方式
- 项目负责人: [姓名]
- 技术支持: [邮箱]
- 文档维护: [团队]

---
*本文档为期货配对交易系统V2.1版需求总览，详细需求请参考各模块文档。*